From a5f1de2759c1cc2c7a0b07c001eae0b6b44e0002 Mon Sep 17 00:00:00 2001
From: Markus Kowalewski <markus.kowalewski@gmail.com>
Date: Sat, 31 May 2025 00:36:51 +0200
Subject: [PATCH 1/2] zenoh-c: init at 1.4.0

---
 pkgs/by-name/ze/zenoh-c/package.nix | 53 +++++++++++++++++++++++++++++
 1 file changed, 53 insertions(+)
 create mode 100644 pkgs/by-name/ze/zenoh-c/package.nix

diff --git a/pkgs/by-name/ze/zenoh-c/package.nix b/pkgs/by-name/ze/zenoh-c/package.nix
new file mode 100644
index 00000000000000..39286f61322c48
--- /dev/null
+++ b/pkgs/by-name/ze/zenoh-c/package.nix
@@ -0,0 +1,53 @@
+{
+  lib,
+  stdenv,
+  fetchFromGitHub,
+  cmake,
+  cargo,
+  rustPlatform,
+  rustc,
+}:
+
+stdenv.mkDerivation rec {
+  pname = "zenoh-c";
+  version = "1.4.0"; # nixpkgs-update: no auto update
+
+  src = fetchFromGitHub {
+    owner = "eclipse-zenoh";
+    repo = "zenoh-c";
+    tag = version;
+    hash = "sha256-Mn3diwJgMkYXP9Dn5AqquN1UJ+P+b4QadiXqzzYZK+o=";
+  };
+
+  cargoDeps = rustPlatform.fetchCargoVendor {
+    inherit src pname version;
+    hash = "sha256-Z9xKC7svGPSuQm4KCKOfGAFOdWgSjBK+/LFT3rAebTg=";
+  };
+
+  outputs = [
+    "out"
+    "dev"
+  ];
+
+  nativeBuildInputs = [
+    cmake
+    cargo
+    rustPlatform.cargoSetupHook
+    rustc
+  ];
+
+  postInstall = ''
+    substituteInPlace $out/lib/pkgconfig/zenohc.pc \
+      --replace-fail "\''${prefix}/" ""
+  '';
+
+  meta = {
+    description = "C API for zenoh";
+    homepage = "https://github.com/eclipse-zenoh/zenoh-c";
+    license = with lib.licenses; [
+      asl20
+      epl20
+    ];
+    maintainers = with lib.maintainers; [ markuskowa ];
+  };
+}

From aacdb4fdb1087dd7e8f90fbd7b9cb00bb2298259 Mon Sep 17 00:00:00 2001
From: Markus Kowalewski <markus.kowalewski@gmail.com>
Date: Tue, 10 Jun 2025 11:02:31 +0200
Subject: [PATCH 2/2] zenoh-cpp: init at 1.4.0

---
 pkgs/by-name/ze/zenoh-cpp/package.nix | 47 +++++++++++++++++++++++++++
 1 file changed, 47 insertions(+)
 create mode 100644 pkgs/by-name/ze/zenoh-cpp/package.nix

diff --git a/pkgs/by-name/ze/zenoh-cpp/package.nix b/pkgs/by-name/ze/zenoh-cpp/package.nix
new file mode 100644
index 00000000000000..76add02abb127c
--- /dev/null
+++ b/pkgs/by-name/ze/zenoh-cpp/package.nix
@@ -0,0 +1,47 @@
+{
+  lib,
+  stdenv,
+  fetchFromGitHub,
+  cmake,
+  zenoh-c,
+}:
+
+stdenv.mkDerivation rec {
+  pname = "zenoh-cpp";
+  version = "1.4.0"; # nixpkgs-update: no auto update
+
+  src = fetchFromGitHub {
+    owner = "eclipse-zenoh";
+    repo = "zenoh-cpp";
+    tag = version;
+    hash = "sha256-rznvif87UZbYzZB4yHG4R850qm6Z3beJ1NSG4wrf58M=";
+  };
+
+  cmakeFlags = [
+    "-DZENOHCXX_ZENOHC=ON"
+    "-DZENOHCXX_ZENOHPICO=OFF"
+  ];
+
+  nativeBuildInputs = [
+    cmake
+  ];
+
+  propagatedBuildInputs = [
+    zenoh-c
+  ];
+
+  postInstall = ''
+    substituteInPlace $out/lib/pkgconfig/zenohcxx.pc \
+      --replace-fail "\''${prefix}/" ""
+  '';
+
+  meta = {
+    description = "C++ API for zenoh";
+    homepage = "https://github.com/eclipse-zenoh/zenoh-cpp";
+    license = with lib.licenses; [
+      asl20
+      epl20
+    ];
+    maintainers = with lib.maintainers; [ markuskowa ];
+  };
+}
